<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>荣！断幺！</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding:20px; background:#fafafa; }
    .card { background:#fff; border:1px solid #e6e6e6; padding:18px; border-radius:6px; max-width:900px; margin:12px auto; box-shadow:0 2px 6px rgba(0,0,0,.03); }
    h1 { text-align:center; margin:8px 0 18px; }
    .cols { display:flex; gap:18px; align-items:flex-start; }
    .col { flex:1; min-width:280px; }
    label { display:block; margin:8px 0 4px; font-size:14px; color:#333; }
    input[type="text"], input[type="password"] { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; box-sizing:border-box; }
    button { padding:8px 12px; border-radius:4px; border:1px solid #bbb; background:#f5f5f5; cursor:pointer; }
    .small { font-size:13px; color:#666; }
    #out { background:#f7f7f7; padding:8px; border:1px solid #ddd; min-height:120px; white-space:pre-wrap; }
    .hidden { display:none; }
    #logoutBtn { float:right; }
    .choices { margin-top:10px; }
    .notice { color:#b00; font-size:13px; margin-top:8px; }
    .radio-row { display:flex; gap:8px; align-items:center; }
    .radio-row label { display:inline-flex; align-items:center; gap:6px; margin:0; font-size:14px; }
    .flags-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .flags-row label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin: 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="card" id="authCard">
    <h1>荣！断幺！ 点数计算器 — 登录</h1>

    <!-- 登录面板（默认显示） -->
    <div id="loginPanel">
      <label for="loginUser">用户名</label>
      <input id="loginUser" type="text" />
      <label for="loginPass">密码</label>
      <input id="loginPass" type="password" />
      <div style="margin-top:10px">
        <button id="loginBtn">登录</button>
        <button id="showRegBtn" type="button" style="margin-left:8px">新用户点此注册</button>
      </div>
      <div id="loginMsg" class="notice"></div>
    </div>

    <!-- 注册面板（初始隐藏，点击“新用户点此注册”显示） -->
    <div id="regPanel" class="hidden" style="margin-top:12px">
      <label for="regUser">用户名</label>
      <input id="regUser" type="text" />
      <label for="regPass">密码</label>
      <input id="regPass" type="password" />
      <div style="margin-top:10px">
        <button id="regBtn">注册</button>
        <button id="cancelRegBtn" type="button" style="margin-left:8px">取消</button>
      </div>
      <div id="regMsg" class="notice"></div>
    </div>

  </div>

  <div class="card hidden" id="appCard">
    <div style="display:flex;align-items:center;">
      <h1 style="flex:1;margin:0">荣！断幺！点数计算器</h1>
      <div>
        <span id="who" class="small"></span>
        <button id="logoutBtn">退出</button>
      </div>
    </div>

    <form id="cfg" style="display:grid;grid-template-columns:120px 1fr;gap:6px 12px;margin-top:12px">
        <label for="hand">手牌</label>
        <input id="hand" name="hand" type="text">

        <label for="hupai">和牌</label>
        <input id="hupai" name="hupai" type="text">

        <label for="dora">宝牌</label>
        <input id="dora" name="dora" type="text">

        <label>场风</label>
        <div id="changfeng" class="radio-row" style="display:flex;gap:8px;align-items:center">
            <label><input type="radio" name="changfeng" value="东"> 东</label>
            <label><input type="radio" name="changfeng" value="南"> 南</label>
            <label><input type="radio" name="changfeng" value="西"> 西</label>
        </div>

        <label>自风</label>
        <div id="zifeng" class="radio-row" style="display:flex;gap:8px;align-items:center">
            <label><input type="radio" name="zifeng" value="东"> 东</label>
            <label><input type="radio" name="zifeng" value="南"> 南</label>
            <label><input type="radio" name="zifeng" value="西"> 西</label>
            <label><input type="radio" name="zifeng" value="北"> 北</label>
        </div>

        <div class="flags-row" style="grid-column: 1 / -1">
            <label><input type="checkbox" name="wlizhi" value="0">两立直</label>
            <label><input type="checkbox" name="lizhi" value="0">立直</label>
            <label><input type="checkbox" name="yifa" value="0">一发</label>
            <label><input type="checkbox" name="zimo" value="0">自摸</label>
            <label><input type="checkbox" name="fulu" value="0">副露</label>
            <label><input type="checkbox" name="qianggang" value="0">枪杠</label>
            <label><input type="checkbox" name="lingshang" value="0">岭上开花</label>
            <label><input type="checkbox" name="hedi" value="0">河底摸鱼</label>
            <label><input type="checkbox" name="haidi" value="0">海底捞月</label>
        </div>

        <div id="ldora-container" style="display:none; grid-column: 1 / -1;grid-template-columns:120px 1fr;gap:6px 12px">
            <label for="ldora">里宝牌</label>
            <input id="ldora" name="ldora" type="text">
        </div>

        <div></div>
        <div style="display:flex;gap:8px">
            <button id="run" type="button">运行</button>
            <button type="reset">重置</button>
        </div>

        <label>输出</label>
        <pre id="out" style="background:#f7f7f7;padding:8px;border:1px solid #ddd; min-height:140px;"></pre>
    </form>

    <div id="dynamicChoices"></div>

  </div>

  <script>
    // 简单前端“用户系统” —— 将用户信息保存在 localStorage（仅用于本地测试）
    const USERS_KEY = 'duanyao_users';
    const CURRENT_KEY = 'duanyao_current';

    function loadUsers() {
      try { return JSON.parse(localStorage.getItem(USERS_KEY) || '{}'); } catch(e) { return {}; }
    }
    function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

    function setCurrent(username){ localStorage.setItem(CURRENT_KEY, username); }
    function getCurrent(){ return localStorage.getItem(CURRENT_KEY); }
    function clearCurrent(){ localStorage.removeItem(CURRENT_KEY); }

    // 页面行为
    document.addEventListener('DOMContentLoaded', () => {
      const loginBtn = document.getElementById('loginBtn');
      const regBtn = document.getElementById('regBtn');
      const showRegBtn = document.getElementById('showRegBtn');
      const cancelRegBtn = document.getElementById('cancelRegBtn');
      const loginMsg = document.getElementById('loginMsg');
      const regMsg = document.getElementById('regMsg');

      // 显示/隐藏面板
      function showLoginPanel(){
        const h = document.querySelector('#authCard h1');
        if (h) h.textContent = '荣！断幺！ 点数计算器 — 登录';
        document.getElementById('loginPanel').classList.remove('hidden');
        document.getElementById('regPanel').classList.add('hidden');
        regMsg.textContent = '';
      }
      function showRegPanel(){
        const h = document.querySelector('#authCard h1');
        if (h) h.textContent = '荣！断幺！ 点数计算器 — 注册';
        document.getElementById('loginPanel').classList.add('hidden');
        document.getElementById('regPanel').classList.remove('hidden');
        loginMsg.textContent = '';
      }

      showRegBtn.addEventListener('click', () => showRegPanel());
      cancelRegBtn.addEventListener('click', () => showLoginPanel());

      // 注册
      regBtn.addEventListener('click', () => {
        const u = document.getElementById('regUser').value.trim();
        const p = document.getElementById('regPass').value;
        if (!u || !p) { regMsg.style.color = '#b00'; regMsg.textContent = '用户名和密码不能为空'; return; }
        const users = loadUsers();
        if (users[u]) { regMsg.style.color = '#b00'; regMsg.textContent = '用户名已存在'; return; }
        users[u] = { pwd: p };
        saveUsers(users);
        regMsg.style.color = 'green';
        regMsg.textContent = '注册成功，返回登录页面';
        // 自动切回登录并预填用户名
        document.getElementById('loginUser').value = u;
        document.getElementById('regUser').value = '';
        document.getElementById('regPass').value = '';
        setTimeout(showLoginPanel, 800);
      });

      function resetAppState() {
      // 清空主要输入字段
      ['hand','hupai','dora','ldora'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });

      // 取消选择的单选与复选
      document.querySelectorAll('#cfg input[type="radio"]').forEach(i => i.checked = false);
      document.querySelectorAll('#cfg input[type="checkbox"]').forEach(i => i.checked = false);

      // 清空输出与动态选择区
      const out = document.getElementById('out');
      if (out) out.textContent = '';

      const dyn = document.getElementById('dynamicChoices');
      if (dyn) dyn.innerHTML = '';

      const choices = document.getElementById('choices');
      if (choices) choices.remove();

      // 隐藏里宝牌容器
      const ldoraContainer = document.getElementById('ldora-container');
      if (ldoraContainer) ldoraContainer.style.display = 'none';
    }

      // 登录
      loginBtn.addEventListener('click', () => {
        const u = document.getElementById('loginUser').value.trim();
        const p = document.getElementById('loginPass').value;
        if (!u || !p) { loginMsg.style.color = '#b00'; loginMsg.textContent = '用户名和密码不能为空'; return; }
        const users = loadUsers();
        if (!users[u] || users[u].pwd !== p) { loginMsg.style.color = '#b00'; loginMsg.textContent = '用户名或密码错误'; return; }
        setCurrent(u);
        resetAppState();
        // 切换到应用界面
        document.getElementById('authCard').classList.add('hidden');
        document.getElementById('appCard').classList.remove('hidden');
        document.getElementById('who').textContent = '已登录：' + u;
      });

      // 退出
      document.getElementById('logoutBtn').addEventListener('click', () => {
        clearCurrent();
        resetAppState();
        // 回到登录页面
        document.getElementById('appCard').classList.add('hidden');
        document.getElementById('authCard').classList.remove('hidden');
        showLoginPanel();
        document.getElementById('loginPass').value = '';
      });

      // 初始化：若已登录则直接显示应用，否则显示登录面板
      if (getCurrent()) {
        document.getElementById('authCard').classList.add('hidden');
        document.getElementById('appCard').classList.remove('hidden');
        document.getElementById('who').textContent = '已登录：' + getCurrent();
      } else {
        showLoginPanel();
      }

      // 控制里宝牌显示（与原逻辑保持）
      const ldoraContainer = document.getElementById('ldora-container');
      const wlizhiCheckbox = document.querySelector('input[name="wlizhi"]');
      const lizhiCheckbox = document.querySelector('input[name="lizhi"]');
      function updateLdoraVisibility() {
          if (wlizhiCheckbox && lizhiCheckbox && (wlizhiCheckbox.checked || lizhiCheckbox.checked)) {
              ldoraContainer.style.display = 'grid';
          } else if (ldoraContainer) {
              ldoraContainer.style.display = 'none';
          }
      }
      if (wlizhiCheckbox) wlizhiCheckbox.addEventListener('change', updateLdoraVisibility);
      if (lizhiCheckbox) lizhiCheckbox.addEventListener('change', updateLdoraVisibility);
      updateLdoraVisibility();
    });
  </script>

  <script src="read.js"></script>
</body>
</html>