<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>荣！断幺！ - 注册</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding:20px; background:#fafafa; }
    .card { background:#fff; border:1px solid #e6e6e6; padding:18px; border-radius:6px; max-width:900px; margin:12px auto; box-shadow:0 2px 6px rgba(0,0,0,.03); }
    h1 { text-align:center; margin:8px 0 18px; }
    label { display:block; margin:8px 0 4px; font-size:14px; color:#333; }
    input[type="text"], input[type="password"] { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; box-sizing:border-box; }
    button { padding:8px 12px; border-radius:4px; border:1px solid #bbb; background:#f5f5f5; cursor:pointer; }
    .notice { color:#b00; font-size:13px; margin-top:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>荣！断幺！ 点数计算器 — 注册</h1>
    <label for="regUser">用户名</label>
    <input id="regUser" type="text" />
    <label for="regPass">密码</label>
    <input id="regPass" type="password" />
    <div style="margin-top:10px">
      <button id="regBtn">注册</button>
      <button id="cancelRegBtn" type="button" style="margin-left:8px">取消</button>
    </div>
    <div id="regMsg" class="notice"></div>
  </div>

  <script>
    const BACKEND = 'http://127.0.0.1:3000';

    document.getElementById('regBtn').addEventListener('click', async () => {
      const u = document.getElementById('regUser').value.trim();
      const p = document.getElementById('regPass').value;
      const regMsg = document.getElementById('regMsg');
      if (!u || !p) { regMsg.textContent = '用户名和密码不能为空'; return; }
      try {
        const r = await fetch(BACKEND + '/api/auth', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ action: 'register', username: u, password: p })
        });
        const j = await r.json();
        if (j && j.success) {
          window.location.href = 'login.html'; // 注册成功跳转回登录页面
        } else {
          regMsg.textContent = j.error || '注册失败';
        }
      } catch (e) {
        regMsg.textContent = '网络或服务器错误';
      }
    });

    document.getElementById('cancelRegBtn').addEventListener('click', () => {
      window.location.href = 'login.html'; // 取消注册跳转回登录页面
    });
  </script>

  <script src="user.js"></script>
</body>
</html>